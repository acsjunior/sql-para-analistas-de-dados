

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>2. Relacionamentos &#8212; SQL para Analistas de Dados</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/02/relationship';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="prev" title="1. Introdução" href="../01/introduction.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    <p class="title logo__title">SQL para Analistas de Dados</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../index.html">
                    Prefácio
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../01/introduction.html">1. Introdução</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">2. Relacionamentos</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/juniorssz/sql-para-analistas-de-dados" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/juniorssz/sql-para-analistas-de-dados/issues/new?title=Issue%20on%20page%20%2Fcontent/02/relationship.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/content/02/relationship.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Relacionamentos</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#relacionamento-1-1-um-para-um">2.1. Relacionamento 1:1 (um para um)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#relacionamento-1-n-um-para-muitos">2.2. Relacionamento 1:N (um para muitos)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#relacionamento-n-n-muitos-para-muitos">2.3. Relacionamento N:N (muitos para muitos)</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="relacionamentos">
<h1><span class="section-number">2. </span>Relacionamentos<a class="headerlink" href="#relacionamentos" title="Permalink to this heading">#</a></h1>
<p>Em um banco de dados relacional, as associações entre tabelas são chamadas de relacionamentos. Esses relacionamentos são estabelecidos por meios de atributos (colunas) chave para criar uma estrutura organizada e eficiente para o armazenamento e a recuperação dos dados.</p>
<p>Neste capítulo serão apresentados, por meio de exemplos práticos, os 3 possíveis tipos de relacionamentos entre tabelas. Além disso, serão definidos o que são chaves primária e estrangeira, conceitos fundamentais para compreender os relacionamentos. Os exemplos práticos podem ser reproduzidos facilmente no Jupyter Notebook. Se você não tem familiaridade com SQL, recomendo que leia a subseção <a class="reference internal" href="../01/introduction.html#introduction-reproduction"><span class="std std-ref">Como reproduzir os exemplos?</span></a>.</p>
<section id="relacionamento-1-1-um-para-um">
<h2><span class="section-number">2.1. </span>Relacionamento 1:1 (um para um)<a class="headerlink" href="#relacionamento-1-1-um-para-um" title="Permalink to this heading">#</a></h2>
<p>Para exemplificarmos, vamos começar a construir o banco de dados de um sistema de e-commerce, conforme o seguinte <strong>Diagrama Entidade-Relacionamento (DER)</strong>:</p>
<a class="reference internal image-reference" href="../../_images/schema_ecom.png"><img alt="schema" class="align-center" src="../../_images/schema_ecom.png" style="width: 800px;" /></a>
<div class="tip admonition">
<p class="admonition-title">Dica</p>
<p>O DER é uma ferramenta utilizada em projetos de bancos de dados, para representar de forma gráfica a estrutura lógica de um banco de dados. Para saber um pouco mais, leia <a class="reference external" href="https://www.alura.com.br/artigos/mer-e-der-funcoes">este artigo</a>.</p>
</div>
<p>Neste banco de dados, a tabela <em>tb_cliente</em> deve armazenar os dados pessoais dos clientes desta empresa. Nela, cada cliente cadastrado deve receber um código único, que será armazenado por meio do atributo <em>cd_cliente</em>. Além disso, a tabela deve armazenar nome, e-mail e data de nascimento dos clientes. Para criarmos a tabela, precisamos antes criar e estabelecer conexão com o banco de dados <em>ecom.db</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> sql
<span class="o">%</span><span class="k">sql</span> sqlite:///ecom.db
</pre></div>
</div>
</div>
</div>
<p>Em seguida, executamos as seguintes instruções SQL para criar a tabela e inserir alguns registros:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

CREATE TABLE tb_cliente (
    cd_cliente INTEGER PRIMARY KEY,
    nm_cliente TEXT NOT NULL,
    ds_email TEXT NOT NULL,
    dt_nascimento DATE
);

INSERT INTO tb_cliente (nm_cliente, ds_email, dt_nascimento) VALUES
    (&#39;Noel Rosa&#39;, &#39;noelrosa@gmail.com&#39;, &#39;1910-12-11&#39;),
    (&#39;Clara Nunes&#39;, &#39;claranunes@yahoo.com&#39;, &#39;1942-08-12&#39;),
    (&#39;Clementina de Jesus&#39;, &#39;clementinadejesus@yahoo.com&#39;, &#39;1901-02-07&#39;),
    (&#39;Angenor de Oliveira Cartola&#39;, &#39;cartola@gmail.com&#39;, &#39;1908-10-11&#39;);
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * sqlite:///ecom.db
Done.
4 rows affected.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<p>Para visualizarmos os dados da tabela:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">sql</span> SELECT * FROM tb_cliente
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * sqlite:///ecom.db
Done.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>cd_cliente</th>
            <th>nm_cliente</th>
            <th>ds_email</th>
            <th>dt_nascimento</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>1</td>
            <td>Noel Rosa</td>
            <td>noelrosa@gmail.com</td>
            <td>1910-12-11</td>
        </tr>
        <tr>
            <td>2</td>
            <td>Clara Nunes</td>
            <td>claranunes@yahoo.com</td>
            <td>1942-08-12</td>
        </tr>
        <tr>
            <td>3</td>
            <td>Clementina de Jesus</td>
            <td>clementinadejesus@yahoo.com</td>
            <td>1901-02-07</td>
        </tr>
        <tr>
            <td>4</td>
            <td>Angenor de Oliveira Cartola</td>
            <td>cartola@gmail.com</td>
            <td>1908-10-11</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>Observe no código que a restrição <code>PRIMARY KEY</code> é utilizada no atributo <em>cd_cliente</em>. Isto indica que este atributo identifica de forma única os registros da tabela. Em outras palavras, significa que ele é uma <strong>chave primária</strong> (primary key ou PK).</p>
<p>Continuando, vamos agora criar a tabela <em>tb_conta</em>. Esta tabela deve armazenar os dados de acesso às contas dos clientes. Nela, o atributo <em>ds_usuario</em>, que receberá o nome de usuário dos clientes, será a chave primária. A tabela também terá atributos para armazenar a senha, a data de criação e o código do cliente ao qual a conta pertence.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

CREATE TABLE tb_conta (
    ds_usuario TEXT PRIMARY KEY,
    ds_senha TEXT NOT NULL,
    dt_criacao DATE NOT NULL,
    cd_cliente INTEGER UNIQUE,
    FOREIGN KEY (cd_cliente) REFERENCES tb_cliente (cd_cliente)
);

INSERT INTO tb_conta (ds_usuario, ds_senha, dt_criacao, cd_cliente) VALUES
    (&#39;nrosa&#39;, &#39;conversadebotequim&#39;, CURRENT_DATE, 1),
    (&#39;claran&#39;, &#39;omarserenou&#39;, CURRENT_DATE, 2),
    (&#39;cjesus&#39;, &#39;marinheiroso&#39;, CURRENT_DATE, 3),
    (&#39;cartola&#39;, &#39;precisomeencontrar&#39;, CURRENT_DATE, 4);

SELECT * FROM tb_conta
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * sqlite:///ecom.db
Done.
4 rows affected.
Done.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>ds_usuario</th>
            <th>ds_senha</th>
            <th>dt_criacao</th>
            <th>cd_cliente</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>nrosa</td>
            <td>conversadebotequim</td>
            <td>2023-08-05</td>
            <td>1</td>
        </tr>
        <tr>
            <td>claran</td>
            <td>omarserenou</td>
            <td>2023-08-05</td>
            <td>2</td>
        </tr>
        <tr>
            <td>cjesus</td>
            <td>marinheiroso</td>
            <td>2023-08-05</td>
            <td>3</td>
        </tr>
        <tr>
            <td>cartola</td>
            <td>precisomeencontrar</td>
            <td>2023-08-05</td>
            <td>4</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>Observe na criação da tabela que a restrição <code>FOREIGN KEY</code> é utilizada no campo <em>cd_cliente</em>, referenciando o atributo de mesmo nome na <em>tb_cliente</em>. Isto significa que por meio deste atributo é estabelecido um relacionamento entre as duas tabelas. Assim sendo, podemos dizer que enquanto o atributo <em>cd_cliente</em> da <em>tb_cliente</em> é uma chave primária, na <em>tb_conta</em> o atributo <em>cd_cliente</em> é uma <strong>chave estrangeira</strong>.</p>
<p>Uma vez que um cliente só pode ter uma única conta, e uma conta só pode pertencer a um único cliente, estamos aqui diante do primeiro tipo de relacionament, o <strong>1:1 (um para um)</strong>.</p>
<p>Abaixo um exemplo de consulta para exibir os nomes dos clientes e seus respectivos nomes de usuário:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

SELECT
    cl.nm_cliente,
    co.ds_usuario
FROM tb_cliente as cl
INNER JOIN tb_conta as co
    ON cl.cd_cliente = co.cd_cliente
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * sqlite:///ecom.db
Done.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>nm_cliente</th>
            <th>ds_usuario</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Noel Rosa</td>
            <td>nrosa</td>
        </tr>
        <tr>
            <td>Clara Nunes</td>
            <td>claran</td>
        </tr>
        <tr>
            <td>Clementina de Jesus</td>
            <td>cjesus</td>
        </tr>
        <tr>
            <td>Angenor de Oliveira Cartola</td>
            <td>cartola</td>
        </tr>
    </tbody>
</table></div></div>
</div>
</section>
<section id="relacionamento-1-n-um-para-muitos">
<h2><span class="section-number">2.2. </span>Relacionamento 1:N (um para muitos)<a class="headerlink" href="#relacionamento-1-n-um-para-muitos" title="Permalink to this heading">#</a></h2>
<p>Para avançarmos, vamos agora adicionar no banco de dados a tabela <em>tb_pedido</em>. Nesta tabela, onde serão armazenados os pedidos realizados pelos clientes, <em>cd_pedido</em> será a chave primária e <em>cd_cliente</em>, a chave estrangeira para estabelecer o relacionamento com a <em>tb_cliente</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

CREATE TABLE tb_pedido (
    cd_pedido INTEGER PRIMARY KEY,
    dt_pedido DATETIME NOT NULL,
    cd_cliente INTEGER,
    FOREIGN KEY (cd_cliente) REFERENCES tb_cliente (cd_cliente)
);

INSERT INTO tb_pedido (dt_pedido, cd_cliente)
VALUES
    (&#39;2023-01-08 08:00:00&#39;, 2), 
    (&#39;2023-01-15 10:30:00&#39;, 1),
    (&#39;2023-01-30 18:20:00&#39;, 4),
    (&#39;2023-02-12 09:45:00&#39;, 3),
    (&#39;2023-02-20 14:45:00&#39;, 1),
    (&#39;2023-03-05 20:45:00&#39;, 4),
    (&#39;2023-03-10 09:15:00&#39;, 1),
    (&#39;2023-03-18 11:30:00&#39;, 2),
    (&#39;2023-04-05 12:00:00&#39;, 1),
    (&#39;2023-04-25 17:00:00&#39;, 3),
    (&#39;2023-05-06 13:10:00&#39;, 2),
    (&#39;2023-05-22 16:20:00&#39;, 1),
    (&#39;2023-06-15 15:30:00&#39;, 3);

SELECT * FROM tb_pedido
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * sqlite:///ecom.db
Done.
13 rows affected.
Done.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>cd_pedido</th>
            <th>dt_pedido</th>
            <th>cd_cliente</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>1</td>
            <td>2023-01-08 08:00:00</td>
            <td>2</td>
        </tr>
        <tr>
            <td>2</td>
            <td>2023-01-15 10:30:00</td>
            <td>1</td>
        </tr>
        <tr>
            <td>3</td>
            <td>2023-01-30 18:20:00</td>
            <td>4</td>
        </tr>
        <tr>
            <td>4</td>
            <td>2023-02-12 09:45:00</td>
            <td>3</td>
        </tr>
        <tr>
            <td>5</td>
            <td>2023-02-20 14:45:00</td>
            <td>1</td>
        </tr>
        <tr>
            <td>6</td>
            <td>2023-03-05 20:45:00</td>
            <td>4</td>
        </tr>
        <tr>
            <td>7</td>
            <td>2023-03-10 09:15:00</td>
            <td>1</td>
        </tr>
        <tr>
            <td>8</td>
            <td>2023-03-18 11:30:00</td>
            <td>2</td>
        </tr>
        <tr>
            <td>9</td>
            <td>2023-04-05 12:00:00</td>
            <td>1</td>
        </tr>
        <tr>
            <td>10</td>
            <td>2023-04-25 17:00:00</td>
            <td>3</td>
        </tr>
        <tr>
            <td>11</td>
            <td>2023-05-06 13:10:00</td>
            <td>2</td>
        </tr>
        <tr>
            <td>12</td>
            <td>2023-05-22 16:20:00</td>
            <td>1</td>
        </tr>
        <tr>
            <td>13</td>
            <td>2023-06-15 15:30:00</td>
            <td>3</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>Note que neste relacionamento, um cliente pode realizar muitos pedidos. Por outro lado, um pedido só pode estar associado a um único cliente. Logo, temos agora um relacionamento do tipo <strong>1:N (um para muitos)</strong>.</p>
<p>Abaixo um exemplo de consulta para exibir a data dos pedidos e o nome dos respectivos clientes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

SELECT
    p.dt_pedido,
    c.nm_cliente
FROM tb_pedido as p
INNER JOIN tb_cliente as c
    ON p.cd_cliente = c.cd_cliente
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * sqlite:///ecom.db
Done.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>dt_pedido</th>
            <th>nm_cliente</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>2023-01-08 08:00:00</td>
            <td>Clara Nunes</td>
        </tr>
        <tr>
            <td>2023-01-15 10:30:00</td>
            <td>Noel Rosa</td>
        </tr>
        <tr>
            <td>2023-01-30 18:20:00</td>
            <td>Angenor de Oliveira Cartola</td>
        </tr>
        <tr>
            <td>2023-02-12 09:45:00</td>
            <td>Clementina de Jesus</td>
        </tr>
        <tr>
            <td>2023-02-20 14:45:00</td>
            <td>Noel Rosa</td>
        </tr>
        <tr>
            <td>2023-03-05 20:45:00</td>
            <td>Angenor de Oliveira Cartola</td>
        </tr>
        <tr>
            <td>2023-03-10 09:15:00</td>
            <td>Noel Rosa</td>
        </tr>
        <tr>
            <td>2023-03-18 11:30:00</td>
            <td>Clara Nunes</td>
        </tr>
        <tr>
            <td>2023-04-05 12:00:00</td>
            <td>Noel Rosa</td>
        </tr>
        <tr>
            <td>2023-04-25 17:00:00</td>
            <td>Clementina de Jesus</td>
        </tr>
        <tr>
            <td>2023-05-06 13:10:00</td>
            <td>Clara Nunes</td>
        </tr>
        <tr>
            <td>2023-05-22 16:20:00</td>
            <td>Noel Rosa</td>
        </tr>
        <tr>
            <td>2023-06-15 15:30:00</td>
            <td>Clementina de Jesus</td>
        </tr>
    </tbody>
</table></div></div>
</div>
</section>
<section id="relacionamento-n-n-muitos-para-muitos">
<h2><span class="section-number">2.3. </span>Relacionamento N:N (muitos para muitos)<a class="headerlink" href="#relacionamento-n-n-muitos-para-muitos" title="Permalink to this heading">#</a></h2>
<p>Para demonstrar o terceiro e último tipo de relacionamento, vamos começar criando a <em>tb_produto</em>. Nesta tabela, que armazenará os produtos cadastrados no sistema, o atributo <em>cd_produto</em> será a chave primária. Além disso, criaremos atributos para a descrição do produto, a categoria e o preço.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

CREATE TABLE tb_produto (
    cd_produto INTEGER PRIMARY KEY,
    ds_produto TEXT NOT NULL,
    vl_preco REAL NOT NULL
);

INSERT INTO tb_produto (ds_produto, vl_preco) VALUES
    (&#39;Smartphone X&#39;, 3600.00),
    (&#39;Fones de Ouvido Y&#39;, 120.00),
    (&#39;Sofá Conforto&#39;, 2300.00),
    (&#39;Aspirador de Pó&#39;, 300.00);

SELECT * FROM tb_produto
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * sqlite:///ecom.db
Done.
4 rows affected.
Done.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>cd_produto</th>
            <th>ds_produto</th>
            <th>vl_preco</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>1</td>
            <td>Smartphone X</td>
            <td>3600.0</td>
        </tr>
        <tr>
            <td>2</td>
            <td>Fones de Ouvido Y</td>
            <td>120.0</td>
        </tr>
        <tr>
            <td>3</td>
            <td>Sofá Conforto</td>
            <td>2300.0</td>
        </tr>
        <tr>
            <td>4</td>
            <td>Aspirador de Pó</td>
            <td>300.0</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>É natural pensarmos que um pedido pode conter um ou mais produtos, ao passo que um produto pode estar associado a um ou mais pedidos. Neste caso, temos um relacionamento do tipo <strong>N:N (muitos para muitos)</strong>. No entanto, não é possível estabelecer este tipo de relacionamento de maneira direta, como nos dois exemplos anteriores. Assim sendo, criaremos a tabela <em>tb_detalhes_pedido</em> para associar os produtos, bem como as quantidades compradas, aos seus respectivos pedidos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>
CREATE TABLE tb_detalhes_pedido (
    cd_pedido INTEGER,
    cd_produto INTEGER,
    nr_quantidade INTEGER NOT NULL,
    PRIMARY KEY (cd_pedido, cd_produto),
    FOREIGN KEY (cd_pedido) REFERENCES tb_pedido (cd_pedido),
    FOREIGN KEY (cd_produto) REFERENCES tb_produto (cd_produto)
);

INSERT INTO tb_detalhes_pedido (cd_pedido, cd_produto, nr_quantidade)
VALUES
    (1, 1, 1),
    (1, 4, 2),
    (2, 2, 1),
    (3, 1, 1),
    (3, 2, 2),
    (3, 3, 1),
    (4, 4, 1),
    (5, 1, 1),
    (5, 4, 2),
    (6, 2, 1),
    (7, 3, 1),
    (7, 2, 2),
    (8, 4, 1),
    (9, 1, 1),
    (9, 4, 2),
    (10, 2, 1),
    (11, 3, 1),
    (11, 2, 2),
    (12, 4, 1),
    (13, 1, 1),
    (13, 4, 2);

SELECT * FROM tb_detalhes_pedido
LIMIT 10
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * sqlite:///ecom.db
Done.
21 rows affected.
Done.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>cd_pedido</th>
            <th>cd_produto</th>
            <th>nr_quantidade</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>1</td>
            <td>1</td>
            <td>1</td>
        </tr>
        <tr>
            <td>1</td>
            <td>4</td>
            <td>2</td>
        </tr>
        <tr>
            <td>2</td>
            <td>2</td>
            <td>1</td>
        </tr>
        <tr>
            <td>3</td>
            <td>1</td>
            <td>1</td>
        </tr>
        <tr>
            <td>3</td>
            <td>2</td>
            <td>2</td>
        </tr>
        <tr>
            <td>3</td>
            <td>3</td>
            <td>1</td>
        </tr>
        <tr>
            <td>4</td>
            <td>4</td>
            <td>1</td>
        </tr>
        <tr>
            <td>5</td>
            <td>1</td>
            <td>1</td>
        </tr>
        <tr>
            <td>5</td>
            <td>4</td>
            <td>2</td>
        </tr>
        <tr>
            <td>6</td>
            <td>2</td>
            <td>1</td>
        </tr>
    </tbody>
</table></div></div>
</div>
<p>Vamos analisar a esrutura desta tabela. Observe que a chave primária é composta pelos atributos <em>cd_pedido</em> e <em>cd_produto</em>. Isto significa que a combinação destes dois atributos identificam o registro de forma única. Quando a chave primária é composta por mais de uma atributo, também dizemos que ela é uma <strong>chave composta</strong>. Além disso, observe que há um relacionamento do tipo 1:N com a <em>tb_pedido</em>, por meio do atributo <em>cd_pedido</em>, e um relacionamento do tipo 1:N com a <em>tb_produto</em>, por meio od atributo <em>cd_produto</em>, que em conjunto configuram o relacionamento N:N entre <em>tb_pedido</em> e <em>tb_produto</em>.</p>
<p>Abaixo um exemplo de consulta para exibir os produtos de cada pedido, bem como o preço unitário, a quantidade pedida e o preço total:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

SELECT
    pe.cd_pedido,
    pe.dt_pedido,
    pr.ds_produto,
    pr.vl_preco,
    dp.nr_quantidade,
    pr.vl_preco * dp.nr_quantidade as total
FROM tb_detalhes_pedido as dp
INNER JOIN tb_pedido as pe
    ON dp.cd_pedido = pe.cd_pedido
INNER JOIN tb_produto as pr
    on dp.cd_produto = pr.cd_produto
LIMIT 10
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * sqlite:///ecom.db
Done.
</pre></div>
</div>
<div class="output text_html"><table>
    <thead>
        <tr>
            <th>cd_pedido</th>
            <th>dt_pedido</th>
            <th>ds_produto</th>
            <th>vl_preco</th>
            <th>nr_quantidade</th>
            <th>total</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>1</td>
            <td>2023-01-08 08:00:00</td>
            <td>Smartphone X</td>
            <td>3600.0</td>
            <td>1</td>
            <td>3600.0</td>
        </tr>
        <tr>
            <td>1</td>
            <td>2023-01-08 08:00:00</td>
            <td>Aspirador de Pó</td>
            <td>300.0</td>
            <td>2</td>
            <td>600.0</td>
        </tr>
        <tr>
            <td>2</td>
            <td>2023-01-15 10:30:00</td>
            <td>Fones de Ouvido Y</td>
            <td>120.0</td>
            <td>1</td>
            <td>120.0</td>
        </tr>
        <tr>
            <td>3</td>
            <td>2023-01-30 18:20:00</td>
            <td>Smartphone X</td>
            <td>3600.0</td>
            <td>1</td>
            <td>3600.0</td>
        </tr>
        <tr>
            <td>3</td>
            <td>2023-01-30 18:20:00</td>
            <td>Fones de Ouvido Y</td>
            <td>120.0</td>
            <td>2</td>
            <td>240.0</td>
        </tr>
        <tr>
            <td>3</td>
            <td>2023-01-30 18:20:00</td>
            <td>Sofá Conforto</td>
            <td>2300.0</td>
            <td>1</td>
            <td>2300.0</td>
        </tr>
        <tr>
            <td>4</td>
            <td>2023-02-12 09:45:00</td>
            <td>Aspirador de Pó</td>
            <td>300.0</td>
            <td>1</td>
            <td>300.0</td>
        </tr>
        <tr>
            <td>5</td>
            <td>2023-02-20 14:45:00</td>
            <td>Smartphone X</td>
            <td>3600.0</td>
            <td>1</td>
            <td>3600.0</td>
        </tr>
        <tr>
            <td>5</td>
            <td>2023-02-20 14:45:00</td>
            <td>Aspirador de Pó</td>
            <td>300.0</td>
            <td>2</td>
            <td>600.0</td>
        </tr>
        <tr>
            <td>6</td>
            <td>2023-03-05 20:45:00</td>
            <td>Fones de Ouvido Y</td>
            <td>120.0</td>
            <td>1</td>
            <td>120.0</td>
        </tr>
    </tbody>
</table></div></div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./content/02"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="../01/introduction.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">1. </span>Introdução</p>
      </div>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#relacionamento-1-1-um-para-um">2.1. Relacionamento 1:1 (um para um)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#relacionamento-1-n-um-para-muitos">2.2. Relacionamento 1:N (um para muitos)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#relacionamento-n-n-muitos-para-muitos">2.3. Relacionamento N:N (muitos para muitos)</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By António C. da Silva Júnior
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>